---
layout : post
title : pandas 정리-2
subtitle : pandas 정리-2
category : 프로그래밍 언어 공부
tags : python
date : 2019-04-23 22:23:00
---


# Pandas 정리 2번째



```python
import pandas as pd
```

## apply

데이터프레임에 행이나 열을 별로 함수를 적용하고 싶을 때 사용하는 함수이다.
## 사용법
데이터프레임변수.apply(특정함수)





```python
##데이터 프레임 정의
df = pd.DataFrame({'A':[1,3,4,3,4], 'B':[2,3,1,2,3], 'C':[1,5,2,4,4]})
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>3</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>3</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>




```python
def diff(x):  ## 집합형 자료형의 최댓값에서 최솟값을 빼준는 함수 정의
    return x.max()-x.min()


df.apply(diff)
```




    A    3
    B    2
    C    4
    dtype: int64



apply함수의 default 기준은 열(columns)이라서 위의 코드는 행을 기준으로 diff함수가 적용된다.  
만약 행(row)을 기준으로 적용하고 싶다면 옵션에 axis=1을 추가해준다.


```python
df.apply(diff, axis = 1)
```




    0    1
    1    2
    2    3
    3    2
    4    1
    dtype: int64



집합형 자료형의 각각의 원소가 몇 개가 있는지 알려주는 함수가 있다.  
리스트 [1,2,3]의 각각의 원소의 갯수를 나타내 보자.


```python
pd.value_counts([1,2,3])
```




    3    1
    2    1
    1    1
    dtype: int64



위의 함수를 apply함수에 넣으면 각각의 원소가 column마다 몇 개 있는지 알 수 있다.


```python
df.apply(pd.value_counts)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.0</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>



데이터프레임을 보니 nan값이 있다. nan값은 어떻게 처리를 해야 할까?  
fillna를 쓰자.  
만약 nan값을 0으로 바꾸고 싶다면 밑의 코드처럼 써주면 된다.


```python
df.apply(pd.value_counts).fillna(0)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.0</td>
      <td>0.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>



위의 결과값을 보니 실수형인게 걸린다.  
그러면 astype을 이용해서 int형으로 바꿔줄 수 있다.


```python
df.apply(pd.value_counts).fillna(0).astype(int)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>



## cut
실수값을 카테고리 값으로 변환하는 하는 함수.  
결과값으로 각 원소가 어느 카테고리에 들어있는지 리스트로 나오게 된다
## 사용법
pd.cut(카테고리화 시키고 싶은 집합형 자료형, 기준이 되는 집합형 자료형, labels = 카테고리이름이 포함되어 있는 자료형)  

이렇게 보면 헷갈리니 예시를 한 번 보자


```python
ages = [0,2,10,21,23,27,37,61,34,56,3,100]

labels = ['미성년자', '청년', '중년', '장년', '노년']
bins = [1,15,25,35,60,90]

cats = pd.cut(ages,bins,labels = labels)
## 다른 변수와 달리 labels = labels라고 한 이유는 labels의 변수의
## 순서가 3번째가 아니기 때문이다.

```

ages의 변수들을 카테고리화 시키고 미성년자, 청년, 중년, 장년, 노년으로 분류하고 싶다.   labels 변수에 카테고리 변수들을 넣고 bins 변수에 카테고리를 나누는 기준이 되는 숫자들을 넣어준다.  
이 때 주의할 점은 bins의 원소는 labels의 원소보다 항상 하나가 많아야 된다.  
이유는 bins의 각 원소의 사이를 하나의 카테고리라고 cut함수가 생각하기 때문이다.
결과값을 한 번 보자


```python
cats
```




    [NaN, 미성년자, 미성년자, 청년, 청년, ..., 노년, 중년, 장년, 미성년자, NaN]
    Length: 12
    Categories (5, object): [미성년자 < 청년 < 중년 < 장년 < 노년]



cut 또한 카테고리를 따로 출력하는 함수를 제공한다.



```python
cats.categories
```




    Index(['미성년자', '청년', '중년', '장년', '노년'], dtype='object')



위의 카테고리를 미성년자를 0으로 노년을 4로 생각해서 카테고리화 시켜주는 함수도 제공한다


```python
cats.codes
```




    array([-1,  0,  0,  1,  1,  2,  3,  4,  2,  3,  0, -1], dtype=int8)



주의할 점은 어느 범위에도 들어가지 않을 때는 -1을 출력한다는 것이다.  
0과 100은 어느 범위에도 들어가지 않으니 -1을 출력해 주었다.

## qcut
전체 데이터를 균등하게 잘라주는 함수  
결과값으로 각 데이터가 어떤 카테고리에 들어있는지 리스트로 나오게 된다.
## 사용법
pd.qcut(나눌 집합형 자료형, 나누고 싶은 갯수, labels = 카테고리 이름을 원소로 가지는 집항형 자료형)


```python
import numpy as np
data= np.random.randn(1000) ## random 함수를 이용해서 data준비
cats1 = pd.qcut(data, 4, labels = ['거북이', '두루미', '삼천갑자', '동박석'])
cats1
```




    [거북이, 거북이, 두루미, 거북이, 동박석, ..., 두루미, 삼천갑자, 삼천갑자, 거북이, 삼천갑자]
    Length: 1000
    Categories (4, object): [거북이 < 두루미 < 삼천갑자 < 동박석]



# 데이터프레임 조작


```python
## 데이터 준비중이니 신경쓰지 마세요.
np.random.seed(0)

np.round(np.random.rand(3,5),2)
list('abcde')

df1 = np.vstack([list('abcde'), np.round(np.random.rand(3,5),2)])
df1 = pd.DataFrame(df1, columns = ['c1', 'c2','c3','c4','c5'])
df1
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c1</th>
      <th>c2</th>
      <th>c3</th>
      <th>c4</th>
      <th>c5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a</td>
      <td>b</td>
      <td>c</td>
      <td>d</td>
      <td>e</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.09</td>
      <td>0.02</td>
      <td>0.83</td>
      <td>0.78</td>
      <td>0.87</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.98</td>
      <td>0.8</td>
      <td>0.46</td>
      <td>0.78</td>
      <td>0.12</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.64</td>
      <td>0.14</td>
      <td>0.94</td>
      <td>0.52</td>
      <td>0.41</td>
    </tr>
  </tbody>
</table>
</div>



## 인덱스 설정하기


set_index 매서드를 사용하자



```python
df2 = df1.set_index('c1')
df2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c2</th>
      <th>c3</th>
      <th>c4</th>
      <th>c5</th>
    </tr>
    <tr>
      <th>c1</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>b</td>
      <td>c</td>
      <td>d</td>
      <td>e</td>
    </tr>
    <tr>
      <th>0.09</th>
      <td>0.02</td>
      <td>0.83</td>
      <td>0.78</td>
      <td>0.87</td>
    </tr>
    <tr>
      <th>0.98</th>
      <td>0.8</td>
      <td>0.46</td>
      <td>0.78</td>
      <td>0.12</td>
    </tr>
    <tr>
      <th>0.64</th>
      <td>0.14</td>
      <td>0.94</td>
      <td>0.52</td>
      <td>0.41</td>
    </tr>
  </tbody>
</table>
</div>



만약 다시 인덱스를 돌리고 싶다면?  
reset_index를 사용해라


```python
df2 = df2.reset_index()
df2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c1</th>
      <th>c2</th>
      <th>c3</th>
      <th>c4</th>
      <th>c5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a</td>
      <td>b</td>
      <td>c</td>
      <td>d</td>
      <td>e</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.09</td>
      <td>0.02</td>
      <td>0.83</td>
      <td>0.78</td>
      <td>0.87</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.98</td>
      <td>0.8</td>
      <td>0.46</td>
      <td>0.78</td>
      <td>0.12</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.64</td>
      <td>0.14</td>
      <td>0.94</td>
      <td>0.52</td>
      <td>0.41</td>
    </tr>
  </tbody>
</table>
</div>



## 다중 인덱스

칼럼이나 로우의 이름을 다시 큰 범위에서 구분하고 싶을 때 사용한다



```python
np.random.seed(0)

df3 = pd.DataFrame(np.round(np.random.randn(5,4),2),
                   columns = [['a','a','b','b'], ['c1','c2','c1','c2']])
## columns의 변수로 칼럼이름 붙이고 싶은 이름을 준다.
df3.columns.names = ['Cidx1', 'Cidx2']
df3
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Cidx1</th>
      <th colspan="2" halign="left">a</th>
      <th colspan="2" halign="left">b</th>
    </tr>
    <tr>
      <th>Cidx2</th>
      <th>c1</th>
      <th>c2</th>
      <th>c1</th>
      <th>c2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.76</td>
      <td>0.40</td>
      <td>0.98</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.87</td>
      <td>-0.98</td>
      <td>0.95</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.10</td>
      <td>0.41</td>
      <td>0.14</td>
      <td>1.45</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.76</td>
      <td>0.12</td>
      <td>0.44</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.49</td>
      <td>-0.21</td>
      <td>0.31</td>
      <td>-0.85</td>
    </tr>
  </tbody>
</table>
</div>



index도 마찬가지 방법으로 행의 이름을 두 부분으로 지어 줄 수 있고 index의 이름도 지정해 줄 수 있다.


```python
df4 = pd.DataFrame(np.round(np.random.randn(5,4),2),
                   columns = [['a','a','b','b'], ['c1','c2','c1','c2']],
                index = [['a1','a2','a3','a4','a5'],['b1','b2','b3','b4','b5']])
df4.columns.names = ['Cidx1', 'Cidx2']
df4.index.names = ['ridx1', 'ridx2']
df4
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th colspan="2" halign="left">a</th>
      <th colspan="2" halign="left">b</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>c1</th>
      <th>c2</th>
      <th>c1</th>
      <th>c2</th>
    </tr>
    <tr>
      <th>ridx1</th>
      <th>ridx2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a1</th>
      <th>b1</th>
      <td>1.88</td>
      <td>-1.35</td>
      <td>-1.27</td>
      <td>0.97</td>
    </tr>
    <tr>
      <th>a2</th>
      <th>b2</th>
      <td>-1.17</td>
      <td>1.94</td>
      <td>-0.41</td>
      <td>-0.75</td>
    </tr>
    <tr>
      <th>a3</th>
      <th>b3</th>
      <td>1.92</td>
      <td>1.48</td>
      <td>1.87</td>
      <td>0.91</td>
    </tr>
    <tr>
      <th>a4</th>
      <th>b4</th>
      <td>-0.86</td>
      <td>1.91</td>
      <td>-0.27</td>
      <td>0.80</td>
    </tr>
    <tr>
      <th>a5</th>
      <th>b5</th>
      <td>0.95</td>
      <td>-0.16</td>
      <td>0.61</td>
      <td>0.92</td>
    </tr>
  </tbody>
</table>
</div>



### 행 인덱스와 열 인덱스의 교환

### stack
열을 행으로 바꿔주는 함수  
### 사용법
데이터프레임.stack(칼럼의 이름)


```python
df4.stack('Cidx1')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Cidx2</th>
      <th>c1</th>
      <th>c2</th>
    </tr>
    <tr>
      <th>ridx1</th>
      <th>ridx2</th>
      <th>Cidx1</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">a1</th>
      <th rowspan="2" valign="top">b1</th>
      <th>a</th>
      <td>1.88</td>
      <td>-1.35</td>
    </tr>
    <tr>
      <th>b</th>
      <td>-1.27</td>
      <td>0.97</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">a2</th>
      <th rowspan="2" valign="top">b2</th>
      <th>a</th>
      <td>-1.17</td>
      <td>1.94</td>
    </tr>
    <tr>
      <th>b</th>
      <td>-0.41</td>
      <td>-0.75</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">a3</th>
      <th rowspan="2" valign="top">b3</th>
      <th>a</th>
      <td>1.92</td>
      <td>1.48</td>
    </tr>
    <tr>
      <th>b</th>
      <td>1.87</td>
      <td>0.91</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">a4</th>
      <th rowspan="2" valign="top">b4</th>
      <th>a</th>
      <td>-0.86</td>
      <td>1.91</td>
    </tr>
    <tr>
      <th>b</th>
      <td>-0.27</td>
      <td>0.80</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">a5</th>
      <th rowspan="2" valign="top">b5</th>
      <th>a</th>
      <td>0.95</td>
      <td>-0.16</td>
    </tr>
    <tr>
      <th>b</th>
      <td>0.61</td>
      <td>0.92</td>
    </tr>
  </tbody>
</table>
</div>



### unstack
행을 열로 바꿔주는 함수

### 사용법
데이터프레임.unstack(로우의이름)


```python
df4.unstack('ridx1')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Cidx1</th>
      <th colspan="10" halign="left">a</th>
      <th colspan="10" halign="left">b</th>
    </tr>
    <tr>
      <th>Cidx2</th>
      <th colspan="5" halign="left">c1</th>
      <th colspan="5" halign="left">c2</th>
      <th colspan="5" halign="left">c1</th>
      <th colspan="5" halign="left">c2</th>
    </tr>
    <tr>
      <th>ridx1</th>
      <th>a1</th>
      <th>a2</th>
      <th>a3</th>
      <th>a4</th>
      <th>a5</th>
      <th>a1</th>
      <th>a2</th>
      <th>a3</th>
      <th>a4</th>
      <th>a5</th>
      <th>a1</th>
      <th>a2</th>
      <th>a3</th>
      <th>a4</th>
      <th>a5</th>
      <th>a1</th>
      <th>a2</th>
      <th>a3</th>
      <th>a4</th>
      <th>a5</th>
    </tr>
    <tr>
      <th>ridx2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>b1</th>
      <td>1.88</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-1.35</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-1.27</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.97</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b2</th>
      <td>NaN</td>
      <td>-1.17</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.94</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-0.41</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-0.75</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.92</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.48</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.87</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.91</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-0.86</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.91</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-0.27</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.8</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b5</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.95</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-0.16</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.61</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.92</td>
    </tr>
  </tbody>
</table>
</div>



### 다중인덱스일 때 인덱싱


```python
df4[('b','c1')] ## (상위 columns, 하위 columns)를 변수로 받는다
```




    ridx1  ridx2
    a1     b1      -1.27
    a2     b2      -0.41
    a3     b3       1.87
    a4     b4      -0.27
    a5     b5       0.61
    Name: (b, c1), dtype: float64




```python
df4
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th colspan="2" halign="left">a</th>
      <th colspan="2" halign="left">b</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>c1</th>
      <th>c2</th>
      <th>c1</th>
      <th>c2</th>
    </tr>
    <tr>
      <th>ridx1</th>
      <th>ridx2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a1</th>
      <th>b1</th>
      <td>1.88</td>
      <td>-1.35</td>
      <td>-1.27</td>
      <td>0.97</td>
    </tr>
    <tr>
      <th>a2</th>
      <th>b2</th>
      <td>-1.17</td>
      <td>1.94</td>
      <td>-0.41</td>
      <td>-0.75</td>
    </tr>
    <tr>
      <th>a3</th>
      <th>b3</th>
      <td>1.92</td>
      <td>1.48</td>
      <td>1.87</td>
      <td>0.91</td>
    </tr>
    <tr>
      <th>a4</th>
      <th>b4</th>
      <td>-0.86</td>
      <td>1.91</td>
      <td>-0.27</td>
      <td>0.80</td>
    </tr>
    <tr>
      <th>a5</th>
      <th>b5</th>
      <td>0.95</td>
      <td>-0.16</td>
      <td>0.61</td>
      <td>0.92</td>
    </tr>
  </tbody>
</table>
</div>




```python
df4[('a','c1')][('a1','b1')]
```




    1.88




```python
df4[('a','c1')][:]
```




    ridx1  ridx2
    a1     b1       1.88
    a2     b2      -1.17
    a3     b3       1.92
    a4     b4      -0.86
    a5     b5       0.95
    Name: (a, c1), dtype: float64




```python
df4[:][('a1','b1'):('a1','b1')]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th colspan="2" halign="left">a</th>
      <th colspan="2" halign="left">b</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>c1</th>
      <th>c2</th>
      <th>c1</th>
      <th>c2</th>
    </tr>
    <tr>
      <th>ridx1</th>
      <th>ridx2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a1</th>
      <th>b1</th>
      <td>1.88</td>
      <td>-1.35</td>
      <td>-1.27</td>
      <td>0.97</td>
    </tr>
  </tbody>
</table>
</div>




```python
df4.loc[('a1','b1')]
```




    Cidx1  Cidx2
    a      c1       1.88
           c2      -1.35
    b      c1      -1.27
           c2       0.97
    Name: (a1, b1), dtype: float64



#### 다중 인덱스에서 인덱스나 head의 이름을 바꾸고 싶다면?
swaplevel을 써라


```python
df5 = df4.swaplevel('ridx1', 'ridx2') ## ridx1과 ridx3를 바꿔준다.
df5
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th colspan="2" halign="left">a</th>
      <th colspan="2" halign="left">b</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>c1</th>
      <th>c2</th>
      <th>c1</th>
      <th>c2</th>
    </tr>
    <tr>
      <th>ridx2</th>
      <th>ridx1</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>b1</th>
      <th>a1</th>
      <td>1.88</td>
      <td>-1.35</td>
      <td>-1.27</td>
      <td>0.97</td>
    </tr>
    <tr>
      <th>b2</th>
      <th>a2</th>
      <td>-1.17</td>
      <td>1.94</td>
      <td>-0.41</td>
      <td>-0.75</td>
    </tr>
    <tr>
      <th>b3</th>
      <th>a3</th>
      <td>1.92</td>
      <td>1.48</td>
      <td>1.87</td>
      <td>0.91</td>
    </tr>
    <tr>
      <th>b4</th>
      <th>a4</th>
      <td>-0.86</td>
      <td>1.91</td>
      <td>-0.27</td>
      <td>0.80</td>
    </tr>
    <tr>
      <th>b5</th>
      <th>a5</th>
      <td>0.95</td>
      <td>-0.16</td>
      <td>0.61</td>
      <td>0.92</td>
    </tr>
  </tbody>
</table>
</div>



### 정렬

### sort_index
인덱스를 알파벳별로 정렬하고 싶으면 사용


```python
df5.sort_index(level = 1) ## 여기서 level은 몇 번째 인덱스를 정렬할 건지 알려주는 옵션, 첫 시작은 0
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th colspan="2" halign="left">a</th>
      <th colspan="2" halign="left">b</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>c1</th>
      <th>c2</th>
      <th>c1</th>
      <th>c2</th>
    </tr>
    <tr>
      <th>ridx2</th>
      <th>ridx1</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>b1</th>
      <th>a1</th>
      <td>1.88</td>
      <td>-1.35</td>
      <td>-1.27</td>
      <td>0.97</td>
    </tr>
    <tr>
      <th>b2</th>
      <th>a2</th>
      <td>-1.17</td>
      <td>1.94</td>
      <td>-0.41</td>
      <td>-0.75</td>
    </tr>
    <tr>
      <th>b3</th>
      <th>a3</th>
      <td>1.92</td>
      <td>1.48</td>
      <td>1.87</td>
      <td>0.91</td>
    </tr>
    <tr>
      <th>b4</th>
      <th>a4</th>
      <td>-0.86</td>
      <td>1.91</td>
      <td>-0.27</td>
      <td>0.80</td>
    </tr>
    <tr>
      <th>b5</th>
      <th>a5</th>
      <td>0.95</td>
      <td>-0.16</td>
      <td>0.61</td>
      <td>0.92</td>
    </tr>
  </tbody>
</table>
</div>



## 연습문제

반	번호	국어	영어	수학  
0	A	1	90	87	89  
1	A	2	85	86	92  
2	A	3	65	98	98  
3	A	4	78	96	100  
4	A	5	95	100	97  
5	B	1	98	100	94  
6	B	2	100	95	78  
7	B	3	97	92	73  
8	B	4	94	91	92  
9	B	5	86	94	71  

위의 데이터를 가지고 있는 txt파일을 가지고 각각의 작업을 수행해라  




```python
## pd.dataframe은 집합형 자료형을 받기 때문에 집항형 자료형으로 변경할 필요가 있음
df = pd.read_table('untitled.txt')
df1 = df.loc[:,'국어':'수학' ] ## 국어부터 수학만 가지고 온다.
df1_values = df1.values  # 집합형 자료형으로 변경
```

    c:\users\administrator\desktop\python package\python_env\lib\site-packages\ipykernel_launcher.py:2: FutureWarning: read_table is deprecated, use read_csv instead, passing sep='\t'.




```python
sol = pd.DataFrame(df1_values, columns = df1.columns ,index = [df['반'].values,df['번호'].values])
sol
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>국어</th>
      <th>영어</th>
      <th>수학</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">A</th>
      <th>1</th>
      <td>90</td>
      <td>87</td>
      <td>89</td>
    </tr>
    <tr>
      <th>2</th>
      <td>85</td>
      <td>86</td>
      <td>92</td>
    </tr>
    <tr>
      <th>3</th>
      <td>65</td>
      <td>98</td>
      <td>98</td>
    </tr>
    <tr>
      <th>4</th>
      <td>78</td>
      <td>96</td>
      <td>100</td>
    </tr>
    <tr>
      <th>5</th>
      <td>95</td>
      <td>100</td>
      <td>97</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">B</th>
      <th>1</th>
      <td>98</td>
      <td>100</td>
      <td>94</td>
    </tr>
    <tr>
      <th>2</th>
      <td>100</td>
      <td>95</td>
      <td>78</td>
    </tr>
    <tr>
      <th>3</th>
      <td>97</td>
      <td>92</td>
      <td>73</td>
    </tr>
    <tr>
      <th>4</th>
      <td>94</td>
      <td>91</td>
      <td>92</td>
    </tr>
    <tr>
      <th>5</th>
      <td>86</td>
      <td>94</td>
      <td>71</td>
    </tr>
  </tbody>
</table>
</div>




```python
sol.index.names = ['반','번호']
```


```python
sol['평균'] = (sol['국어']+sol['영어']+sol['수학'])/3
sol
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>국어</th>
      <th>영어</th>
      <th>수학</th>
      <th>평균</th>
    </tr>
    <tr>
      <th>반</th>
      <th>번호</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">A</th>
      <th>1</th>
      <td>90</td>
      <td>87</td>
      <td>89</td>
      <td>88.666667</td>
    </tr>
    <tr>
      <th>2</th>
      <td>85</td>
      <td>86</td>
      <td>92</td>
      <td>87.666667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>65</td>
      <td>98</td>
      <td>98</td>
      <td>87.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>78</td>
      <td>96</td>
      <td>100</td>
      <td>91.333333</td>
    </tr>
    <tr>
      <th>5</th>
      <td>95</td>
      <td>100</td>
      <td>97</td>
      <td>97.333333</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">B</th>
      <th>1</th>
      <td>98</td>
      <td>100</td>
      <td>94</td>
      <td>97.333333</td>
    </tr>
    <tr>
      <th>2</th>
      <td>100</td>
      <td>95</td>
      <td>78</td>
      <td>91.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>97</td>
      <td>92</td>
      <td>73</td>
      <td>87.333333</td>
    </tr>
    <tr>
      <th>4</th>
      <td>94</td>
      <td>91</td>
      <td>92</td>
      <td>92.333333</td>
    </tr>
    <tr>
      <th>5</th>
      <td>86</td>
      <td>94</td>
      <td>71</td>
      <td>83.666667</td>
    </tr>
  </tbody>
</table>
</div>




```python
sol1 = sol.unstack('반')
sol1
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">국어</th>
      <th colspan="2" halign="left">영어</th>
      <th colspan="2" halign="left">수학</th>
      <th colspan="2" halign="left">평균</th>
    </tr>
    <tr>
      <th>반</th>
      <th>A</th>
      <th>B</th>
      <th>A</th>
      <th>B</th>
      <th>A</th>
      <th>B</th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <th>번호</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>90</td>
      <td>98</td>
      <td>87</td>
      <td>100</td>
      <td>89</td>
      <td>94</td>
      <td>88.666667</td>
      <td>97.333333</td>
    </tr>
    <tr>
      <th>2</th>
      <td>85</td>
      <td>100</td>
      <td>86</td>
      <td>95</td>
      <td>92</td>
      <td>78</td>
      <td>87.666667</td>
      <td>91.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>65</td>
      <td>97</td>
      <td>98</td>
      <td>92</td>
      <td>98</td>
      <td>73</td>
      <td>87.000000</td>
      <td>87.333333</td>
    </tr>
    <tr>
      <th>4</th>
      <td>78</td>
      <td>94</td>
      <td>96</td>
      <td>91</td>
      <td>100</td>
      <td>92</td>
      <td>91.333333</td>
      <td>92.333333</td>
    </tr>
    <tr>
      <th>5</th>
      <td>95</td>
      <td>86</td>
      <td>100</td>
      <td>94</td>
      <td>97</td>
      <td>71</td>
      <td>97.333333</td>
      <td>83.666667</td>
    </tr>
  </tbody>
</table>
</div>




```python
sol1.sum().values/5
```




    array([82.6       , 95.        , 93.4       , 94.4       , 95.2       ,
           81.6       , 90.4       , 90.33333333])




```python
sol1.loc['평균'] = sol1.sum().values/5
sol1
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">국어</th>
      <th colspan="2" halign="left">영어</th>
      <th colspan="2" halign="left">수학</th>
      <th colspan="2" halign="left">평균</th>
    </tr>
    <tr>
      <th>반</th>
      <th>A</th>
      <th>B</th>
      <th>A</th>
      <th>B</th>
      <th>A</th>
      <th>B</th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <th>번호</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>90.0</td>
      <td>98.0</td>
      <td>87.0</td>
      <td>100.0</td>
      <td>89.0</td>
      <td>94.0</td>
      <td>88.666667</td>
      <td>97.333333</td>
    </tr>
    <tr>
      <th>2</th>
      <td>85.0</td>
      <td>100.0</td>
      <td>86.0</td>
      <td>95.0</td>
      <td>92.0</td>
      <td>78.0</td>
      <td>87.666667</td>
      <td>91.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>65.0</td>
      <td>97.0</td>
      <td>98.0</td>
      <td>92.0</td>
      <td>98.0</td>
      <td>73.0</td>
      <td>87.000000</td>
      <td>87.333333</td>
    </tr>
    <tr>
      <th>4</th>
      <td>78.0</td>
      <td>94.0</td>
      <td>96.0</td>
      <td>91.0</td>
      <td>100.0</td>
      <td>92.0</td>
      <td>91.333333</td>
      <td>92.333333</td>
    </tr>
    <tr>
      <th>5</th>
      <td>95.0</td>
      <td>86.0</td>
      <td>100.0</td>
      <td>94.0</td>
      <td>97.0</td>
      <td>71.0</td>
      <td>97.333333</td>
      <td>83.666667</td>
    </tr>
    <tr>
      <th>평균</th>
      <td>82.6</td>
      <td>95.0</td>
      <td>93.4</td>
      <td>94.4</td>
      <td>95.2</td>
      <td>81.6</td>
      <td>90.400000</td>
      <td>90.333333</td>
    </tr>
  </tbody>
</table>
</div>



## 데이터 프레임 병합(합성)

두 데이터 프레임의 공통 열 또는 인덱스를 기준으로 두 개의 테이블을 합친다.  
이때 기준이 되는 열, 행의 데이터를 key라고 한다.


```python
## 데이터 준비 중이오니 신경쓰지 마세용
df1 = pd.DataFrame({
    '고객번호': [1001, 1002, 1003, 1004, 1005, 1006, 1007],
    '이름': ['둘리', '도우너', '또치', '길동', '희동', '마이콜', '영희']
}, columns=['고객번호', '이름'])

df2 = pd.DataFrame({
    '고객번호': [1001, 1001, 1005, 1006, 1008, 1001],
    '금액': [10000, 20000, 15000, 5000, 100000, 30000]
}, columns=['고객번호', '금액'])
```

### merge
두 데이터를 합칠 때 사용



```python
pd.merge(df1,df2)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>고객번호</th>
      <th>이름</th>
      <th>금액</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1001</td>
      <td>둘리</td>
      <td>10000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1001</td>
      <td>둘리</td>
      <td>20000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1001</td>
      <td>둘리</td>
      <td>30000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1005</td>
      <td>희동</td>
      <td>15000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1006</td>
      <td>마이콜</td>
      <td>5000</td>
    </tr>
  </tbody>
</table>
</div>



결과를 보면 sql의 inner join 처럼 df1부터 먼저 나오되 공통된 key값이 두 번은 나오지 않는다.  
고객번호를 가만히 보면 df1과 df2 모두 들어있는 원소만 나온다는 것을 알 수 있다.  



만약 df1의 값들은 다 나오고 싶다!! 그렇다면 left outer join을 사용하자. how = 'left'


```python
pd.merge(df1,df2,how = 'left')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>고객번호</th>
      <th>이름</th>
      <th>금액</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1001</td>
      <td>둘리</td>
      <td>10000.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1001</td>
      <td>둘리</td>
      <td>20000.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1001</td>
      <td>둘리</td>
      <td>30000.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1002</td>
      <td>도우너</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1003</td>
      <td>또치</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1004</td>
      <td>길동</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1005</td>
      <td>희동</td>
      <td>15000.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1006</td>
      <td>마이콜</td>
      <td>5000.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1007</td>
      <td>영희</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



만약 오른쪽 데이터를 다 쓰고 싶다!! 그렇다면 how = 'right'를 주면 된다.


```python
pd.merge(df1,df2,how = 'right')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>고객번호</th>
      <th>이름</th>
      <th>금액</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1001</td>
      <td>둘리</td>
      <td>10000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1001</td>
      <td>둘리</td>
      <td>20000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1001</td>
      <td>둘리</td>
      <td>30000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1005</td>
      <td>희동</td>
      <td>15000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1006</td>
      <td>마이콜</td>
      <td>5000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1008</td>
      <td>NaN</td>
      <td>100000</td>
    </tr>
  </tbody>
</table>
</div>



모든 데이터를 다 나타내고 싶으면 how = 'outer'를 사용하자


```python
pd.merge(df1,df2,how = 'outer')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>고객번호</th>
      <th>이름</th>
      <th>금액</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1001</td>
      <td>둘리</td>
      <td>10000.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1001</td>
      <td>둘리</td>
      <td>20000.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1001</td>
      <td>둘리</td>
      <td>30000.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1002</td>
      <td>도우너</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1003</td>
      <td>또치</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1004</td>
      <td>길동</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1005</td>
      <td>희동</td>
      <td>15000.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1006</td>
      <td>마이콜</td>
      <td>5000.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1007</td>
      <td>영희</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1008</td>
      <td>NaN</td>
      <td>100000.0</td>
    </tr>
  </tbody>
</table>
</div>



merger 속성을 좀 더 알아보자.  
굉장히 유명한 데이터인 꽃 품종 데이터의 몇 개만 흉내내서 써보겠다.


```python
# 데이터 준비중이오니 신경쓰지 마시기 바랍니다.
df1 = pd.DataFrame({
    "품종":["setosa", "setosa", "virginica", "virginica"],
    "꽃잎길이":[1.4, 1.3, 1.5, 1.3]
}, columns=["품종", "꽃잎길이"])

df1


df2 = pd.DataFrame({
    "품종":["setosa", "virginica", "virginica", "versicolor"],
    "꽃잎너비":[0.4, 0.3, 0.5, 0.3]
}, columns=["품종", "꽃잎너비"])

df2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>품종</th>
      <th>꽃잎너비</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>setosa</td>
      <td>0.4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>virginica</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>virginica</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>versicolor</td>
      <td>0.3</td>
    </tr>
  </tbody>
</table>
</div>



df1과 df2를 멀지하면 어떻게 나오게 될까?  
merge는 기준이 되는 칼럼의 element값이 같은게 있는데 그것이 여러개라면 중복해서 다 나오게 된다.


```python
pd.merge(df1,df2)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>품종</th>
      <th>꽃잎길이</th>
      <th>꽃잎너비</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>setosa</td>
      <td>1.4</td>
      <td>0.4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>setosa</td>
      <td>1.3</td>
      <td>0.4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>virginica</td>
      <td>1.5</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>virginica</td>
      <td>1.5</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>virginica</td>
      <td>1.3</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>virginica</td>
      <td>1.3</td>
      <td>0.5</td>
    </tr>
  </tbody>
</table>
</div>



df1과 df2에서 공통된 품종은 setosa와 virginica이다.  
그런데 setosa와 virginica가 중복되서 여러가지가 있는데 merge를 하면 모든 중복된 갯수만큼 merge한 dataframe에  
나오게 된다.

#### merge를 하는데 중요한 부분은 공통된 칼럼이다. 이를 키라고 하는데 이 키가 문제가 생길 때가 있다.

- 키로 가질 수 있는 칼럼이 두 개일 때


```python
## 데이터 준비중
df1 = pd.DataFrame({
    '고객명':['춘향', '춘향', '몽룡'],
    '날짜': ['2018-01-01', '2018-01-02', '2018-01-03'],
    '데이터': ['20000', '30000', '10000']    
})

df2 = pd.DataFrame({
    '고객명':['춘향', '몽룡'],
    '데이터':['여자','남자']
})

display(df1)
display(df2)
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>고객명</th>
      <th>날짜</th>
      <th>데이터</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>춘향</td>
      <td>2018-01-01</td>
      <td>20000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>춘향</td>
      <td>2018-01-02</td>
      <td>30000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>몽룡</td>
      <td>2018-01-03</td>
      <td>10000</td>
    </tr>
  </tbody>
</table>
</div>



<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>고객명</th>
      <th>데이터</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>춘향</td>
      <td>여자</td>
    </tr>
    <tr>
      <th>1</th>
      <td>몽룡</td>
      <td>남자</td>
    </tr>
  </tbody>
</table>
</div>


데이터를 보니 고객명을 데이터로 키로 정해야 한다.  
하지만 두 데이터프레임 전부 칼럼명이 데이터도 있으므로 두 개를 전부 키로 설정하려고 할 것이다.  
이럴 때 쓰는것이 on이다.


```python
pd.merge(df1, df2)   # 이때는 데이터라는 칼럼도 기본 key가 되어버리니깐, 확실히 key를 정해줘야 한다.
pd.merge(df1, df2, on="고객명")   # on이라는 옵션을 써서, 고객명을 기준으로 합치라고 확실히 정해줘야 한다.
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>고객명</th>
      <th>날짜</th>
      <th>데이터_x</th>
      <th>데이터_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>춘향</td>
      <td>2018-01-01</td>
      <td>20000</td>
      <td>여자</td>
    </tr>
    <tr>
      <th>1</th>
      <td>춘향</td>
      <td>2018-01-02</td>
      <td>30000</td>
      <td>여자</td>
    </tr>
    <tr>
      <th>2</th>
      <td>몽룡</td>
      <td>2018-01-03</td>
      <td>10000</td>
      <td>남자</td>
    </tr>
  </tbody>
</table>
</div>



데이터 2개는 구분할 수 있도록 x,y,z 순서대로 첨자가

- 키로 가질 수 있는 칼럼의 이름이 다를 때


```python
df1 = pd.DataFrame({
    '이름' : ['영희','철수','철수'],
    '성적' : [1,2,3],
}, columns = ['이름', '성적'])

df2 = pd.DataFrame({
    '성명' : ['영희','영희','철수'],
    '성적2' : [4,5,6]
})
display(df1)
display(df2)

```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>이름</th>
      <th>성적</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>영희</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>철수</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>철수</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>



<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>성명</th>
      <th>성적2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>영희</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>영희</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>철수</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>


위에서 키는 당연히 df1의 이름 혹은 df2의 성명이 되어야 하는데 문제는 두 칼럼의 이름이 다르다.  
이 때 사용하는 옵션은 left_on, right_on이다.  
코드를 보자.  


```python
pd.merge(df1,df2,left_on = '이름', right_on = '성명')
## 왼쪽 데이터 즉 df1에서 키값은 이름, 오른쪼 데이터 즉 오른쪽 데이터에서 키는 '성명'이라고 알려 주는 것이다.
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>성적</th>
      <th>이름</th>
      <th>성명</th>
      <th>성적2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>영희</td>
      <td>영희</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>영희</td>
      <td>영희</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>철수</td>
      <td>철수</td>
      <td>6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>철수</td>
      <td>철수</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>



이번에는 구조가 완전히 다른 데이터프레임 2개를 합치고 싶다. 일단은 준비된 데이터를 한 번 보자


```python
df1 = pd.DataFrame({
    '도시' : ['서울', '서울', '서울', '부산', '부산'],
    '연도' : [2000,2005,2007,2008,2005],
    '인구' : [9829384,9819283,930282,393039,302938]
})
df2 = pd.DataFrame(
    np.arange(12).reshape(6,2),
    index = [['부산','부산','서울','서울','서울','서울'],[2000,2005,2000,2005,2010,2015]],
    columns = ['데이터1', '데이터2']
)
display(df1)
display(df2)
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>도시</th>
      <th>연도</th>
      <th>인구</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>서울</td>
      <td>2000</td>
      <td>9829384</td>
    </tr>
    <tr>
      <th>1</th>
      <td>서울</td>
      <td>2005</td>
      <td>9819283</td>
    </tr>
    <tr>
      <th>2</th>
      <td>서울</td>
      <td>2007</td>
      <td>930282</td>
    </tr>
    <tr>
      <th>3</th>
      <td>부산</td>
      <td>2008</td>
      <td>393039</td>
    </tr>
    <tr>
      <th>4</th>
      <td>부산</td>
      <td>2005</td>
      <td>302938</td>
    </tr>
  </tbody>
</table>
</div>



<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>데이터1</th>
      <th>데이터2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">부산</th>
      <th>2000</th>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">서울</th>
      <th>2000</th>
      <td>4</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>6</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>8</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>10</td>
      <td>11</td>
    </tr>
  </tbody>
</table>
</div>


데이터를 보면 df1은 도시와 연도를 키값으로 갖고 있다는 것을 알 수 있다.  
df2를 보면 index에 도시와 연도를 가지고 있으므로 이것을 키값으로 사용하면 될 것 같다.
이럴 때는 이렇게 merge를 해보자.


```python
pd.merge(df1,df2,left_on = ['도시','연도'], right_index = True)
## 왼쪽 데이터프레임에서는 '도시'와 '연도' 두개를 키값으로 가지고 싶으므로 left_on = ['도시','연도']
## 넣었따.
## df2의 index를 키로 가지고 싶으면 df2가 오른쪽이므로 right_index = True값을 주었다.
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>도시</th>
      <th>연도</th>
      <th>인구</th>
      <th>데이터1</th>
      <th>데이터2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>서울</td>
      <td>2000</td>
      <td>9829384</td>
      <td>4</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>서울</td>
      <td>2005</td>
      <td>9819283</td>
      <td>6</td>
      <td>7</td>
    </tr>
    <tr>
      <th>4</th>
      <td>부산</td>
      <td>2005</td>
      <td>302938</td>
      <td>2</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>



이번에는 칼럼을 봤을 때 키로 가질 수 있는게 없을 때가 있다.  
이 때 생각할 수 있는 것은 index값들을 키로 가지는 것이다.


```python
## 데이터 준비중입니다.
df1 = pd.DataFrame([[1.,2.], [3.,4.],[5.,6.]],
                  index=['a','c','e'],
                  columns=['서울', '부산'])
df2 = pd.DataFrame([[7.,8.], [9.,10.],[11.,12.], [13.,14.]],
                  index=['b','c','d','e'],
                  columns=['대구', '광주'])

display(df1)
display(df2)
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>서울</th>
      <th>부산</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>c</th>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>e</th>
      <td>5.0</td>
      <td>6.0</td>
    </tr>
  </tbody>
</table>
</div>



<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>대구</th>
      <th>광주</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>b</th>
      <td>7.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>c</th>
      <td>9.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>d</th>
      <td>11.0</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>e</th>
      <td>13.0</td>
      <td>14.0</td>
    </tr>
  </tbody>
</table>
</div>



```python
pd.merge(df1,df2, left_index = True, right_index = True, how = 'outer')
## 두 데이터의 index를 키로 사용하겠다 라는 뜻이고 키로서 모든 알파멧을 사용하고 싶으므로
##how = 'outer'넣어주었다.
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>서울</th>
      <th>부산</th>
      <th>대구</th>
      <th>광주</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>c</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>9.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>d</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>11.0</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>e</th>
      <td>5.0</td>
      <td>6.0</td>
      <td>13.0</td>
      <td>14.0</td>
    </tr>
  </tbody>
</table>
</div>



## 연습문제


```python
df1 = pd.DataFrame({
   'Name' : ['Morning', 'K3', 'K5', 'K8', 'K9'],
   'Segment' : ['Mini', 'Small', 'Mid', 'Sport', 'Large'],
   'Engine' : ['1.0L', '1.6', '2.0', '3.0', '5.0'],
   'Fuel' : ['14km', '18km', '16km', '12km', '10km'],
   'Price' : [1000, 2000, 3000, 4000, 5000]},
   columns = ["Name", "Segment", "Engine", "Fuel", "Price"])


df2 = pd.DataFrame({
   '이름' : ['Morning', 'K3', 'K5', 'K8', 'K9'],
   '출시년도' : ['2000', '2005', '2005', '2016', '2010'],
   '연료' : ['휘발유', '경유', '경유', '휘발유', '휘발유'],
   '마력' : [50, 100, 150, 250, 300],
   '탑승인원' : [4, 5, 5, 4, 4]},
   columns = ["이름", "출시년도", "연료", "마력", "탑승인원"])

display(df1)
display(df2)
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Segment</th>
      <th>Engine</th>
      <th>Fuel</th>
      <th>Price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Morning</td>
      <td>Mini</td>
      <td>1.0L</td>
      <td>14km</td>
      <td>1000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K3</td>
      <td>Small</td>
      <td>1.6</td>
      <td>18km</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>K5</td>
      <td>Mid</td>
      <td>2.0</td>
      <td>16km</td>
      <td>3000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>K8</td>
      <td>Sport</td>
      <td>3.0</td>
      <td>12km</td>
      <td>4000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>K9</td>
      <td>Large</td>
      <td>5.0</td>
      <td>10km</td>
      <td>5000</td>
    </tr>
  </tbody>
</table>
</div>



<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>이름</th>
      <th>출시년도</th>
      <th>연료</th>
      <th>마력</th>
      <th>탑승인원</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Morning</td>
      <td>2000</td>
      <td>휘발유</td>
      <td>50</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K3</td>
      <td>2005</td>
      <td>경유</td>
      <td>100</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>K5</td>
      <td>2005</td>
      <td>경유</td>
      <td>150</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>K8</td>
      <td>2016</td>
      <td>휘발유</td>
      <td>250</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>K9</td>
      <td>2010</td>
      <td>휘발유</td>
      <td>300</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>



```python
pd.merge(df1, df2, left_on = 'Name', right_on = '이름')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Segment</th>
      <th>Engine</th>
      <th>Fuel</th>
      <th>Price</th>
      <th>이름</th>
      <th>출시년도</th>
      <th>연료</th>
      <th>마력</th>
      <th>탑승인원</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Morning</td>
      <td>Mini</td>
      <td>1.0L</td>
      <td>14km</td>
      <td>1000</td>
      <td>Morning</td>
      <td>2000</td>
      <td>휘발유</td>
      <td>50</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K3</td>
      <td>Small</td>
      <td>1.6</td>
      <td>18km</td>
      <td>2000</td>
      <td>K3</td>
      <td>2005</td>
      <td>경유</td>
      <td>100</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>K5</td>
      <td>Mid</td>
      <td>2.0</td>
      <td>16km</td>
      <td>3000</td>
      <td>K5</td>
      <td>2005</td>
      <td>경유</td>
      <td>150</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>K8</td>
      <td>Sport</td>
      <td>3.0</td>
      <td>12km</td>
      <td>4000</td>
      <td>K8</td>
      <td>2016</td>
      <td>휘발유</td>
      <td>250</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>K9</td>
      <td>Large</td>
      <td>5.0</td>
      <td>10km</td>
      <td>5000</td>
      <td>K9</td>
      <td>2010</td>
      <td>휘발유</td>
      <td>300</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>



### concat

inner join 없이 그대로 붙여주는 함수


```python
s1 = pd.Series([0,1], index = ['A','B'])
s2 = pd.Series([2,3,4],index = ['A','B','C'])

pd.concat([s1,s2]) ## 인자로 리스트 []안에 각각의 데이터프레임이 들어간다.가 들어간다.
```




    A    0
    B    1
    A    2
    B    3
    C    4
    dtype: int64




```python
df1  = pd.DataFrame(np.arange(6).reshape(3,2), index = ['a','b','c'], columns = ['데이터1', '데이터2'])
display(df1)

df2 = pd.DataFrame(np.arange(4).reshape(2,2), index = ['a','c'], columns = ['데이터3', '데이터4'])
display(df2)

pd.concat([df1,df2], axis = 0)
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>데이터1</th>
      <th>데이터2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>b</th>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>c</th>
      <td>4</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>



<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>데이터3</th>
      <th>데이터4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>c</th>
      <td>2</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>


    c:\users\administrator\desktop\python package\python_env\lib\site-packages\ipykernel_launcher.py:7: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version
    of pandas will change to not sort by default.

    To accept the future behavior, pass 'sort=False'.

    To retain the current behavior and silence the warning, pass 'sort=True'.

      import sys





<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>데이터1</th>
      <th>데이터2</th>
      <th>데이터3</th>
      <th>데이터4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b</th>
      <td>2.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>c</th>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>a</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>c</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>



## 연습문제

어느 회사의 전반기 1월_6월 실적을 나타내는 데이터프레임과 후반기 7월~12월 실적을 나타내는 데이터프레임을 만든뒤 합친다.  
실적 정보는 '매출', '비용', '이익'으로 이루어진다. (이익 = 매출-비용)  
또한 1년간의 총 실적을 마지막 행으로 덧붙인다.


```python
## 일단은 데이터를 보자.
df1 = pd.DataFrame({
    '매출':[1000,1500,3000,4000,5000,6000],
    '비용':[1500,2000,2500,2700,3000,3200]},
    index = ['1월', '2월', '3월', '4월', '5월' ,'6월'],
    columns = ['매출', '비용']
)

df2 = pd.DataFrame({
    '매출':[3000,4500,5000,6000,2000,1000],
    '비용':[2500,2000,1500,2700,1000,1200]},
    index = ['7월', '8월', '9월', '10월', '11월' ,'12월'],
    columns = ['매출', '비용']
)

display(df1)
display(df2)
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>매출</th>
      <th>비용</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1월</th>
      <td>1000</td>
      <td>1500</td>
    </tr>
    <tr>
      <th>2월</th>
      <td>1500</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>3월</th>
      <td>3000</td>
      <td>2500</td>
    </tr>
    <tr>
      <th>4월</th>
      <td>4000</td>
      <td>2700</td>
    </tr>
    <tr>
      <th>5월</th>
      <td>5000</td>
      <td>3000</td>
    </tr>
    <tr>
      <th>6월</th>
      <td>6000</td>
      <td>3200</td>
    </tr>
  </tbody>
</table>
</div>



<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>매출</th>
      <th>비용</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7월</th>
      <td>3000</td>
      <td>2500</td>
    </tr>
    <tr>
      <th>8월</th>
      <td>4500</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>9월</th>
      <td>5000</td>
      <td>1500</td>
    </tr>
    <tr>
      <th>10월</th>
      <td>6000</td>
      <td>2700</td>
    </tr>
    <tr>
      <th>11월</th>
      <td>2000</td>
      <td>1000</td>
    </tr>
    <tr>
      <th>12월</th>
      <td>1000</td>
      <td>1200</td>
    </tr>
  </tbody>
</table>
</div>



```python
## concat을 이용해서 상반기와 하반기 매출과 비요을 합쳐야겠다.
df3 = pd.concat([df1,df2])
df3
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>매출</th>
      <th>비용</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1월</th>
      <td>1000</td>
      <td>1500</td>
    </tr>
    <tr>
      <th>2월</th>
      <td>1500</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>3월</th>
      <td>3000</td>
      <td>2500</td>
    </tr>
    <tr>
      <th>4월</th>
      <td>4000</td>
      <td>2700</td>
    </tr>
    <tr>
      <th>5월</th>
      <td>5000</td>
      <td>3000</td>
    </tr>
    <tr>
      <th>6월</th>
      <td>6000</td>
      <td>3200</td>
    </tr>
    <tr>
      <th>7월</th>
      <td>3000</td>
      <td>2500</td>
    </tr>
    <tr>
      <th>8월</th>
      <td>4500</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>9월</th>
      <td>5000</td>
      <td>1500</td>
    </tr>
    <tr>
      <th>10월</th>
      <td>6000</td>
      <td>2700</td>
    </tr>
    <tr>
      <th>11월</th>
      <td>2000</td>
      <td>1000</td>
    </tr>
    <tr>
      <th>12월</th>
      <td>1000</td>
      <td>1200</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 오른쪽에 이익 칼럼을 추가하자
df3['이익'] = df3['매출'] - df3['비용']
df3.sum().values
```




    array([42000, 25800, 16200], dtype=int64)




```python
## 맨 마지막에 실적을 추가하자
df3.loc['실적'] = df3.sum().values
df3
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>매출</th>
      <th>비용</th>
      <th>이익</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1월</th>
      <td>1000</td>
      <td>1500</td>
      <td>-500</td>
    </tr>
    <tr>
      <th>2월</th>
      <td>1500</td>
      <td>2000</td>
      <td>-500</td>
    </tr>
    <tr>
      <th>3월</th>
      <td>3000</td>
      <td>2500</td>
      <td>500</td>
    </tr>
    <tr>
      <th>4월</th>
      <td>4000</td>
      <td>2700</td>
      <td>1300</td>
    </tr>
    <tr>
      <th>5월</th>
      <td>5000</td>
      <td>3000</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>6월</th>
      <td>6000</td>
      <td>3200</td>
      <td>2800</td>
    </tr>
    <tr>
      <th>7월</th>
      <td>3000</td>
      <td>2500</td>
      <td>500</td>
    </tr>
    <tr>
      <th>8월</th>
      <td>4500</td>
      <td>2000</td>
      <td>2500</td>
    </tr>
    <tr>
      <th>9월</th>
      <td>5000</td>
      <td>1500</td>
      <td>3500</td>
    </tr>
    <tr>
      <th>10월</th>
      <td>6000</td>
      <td>2700</td>
      <td>3300</td>
    </tr>
    <tr>
      <th>11월</th>
      <td>2000</td>
      <td>1000</td>
      <td>1000</td>
    </tr>
    <tr>
      <th>12월</th>
      <td>1000</td>
      <td>1200</td>
      <td>-200</td>
    </tr>
    <tr>
      <th>실적</th>
      <td>42000</td>
      <td>25800</td>
      <td>16200</td>
    </tr>
  </tbody>
</table>
</div>




```python
data = {
    "도시": ["서울", "서울", "서울", "부산", "부산", "부산", "인천", "인천"],
    "연도": ["2015", "2010", "2005", "2015", "2010", "2005", "2015", "2010"],
    "인구": [9904312, 9631482, 9762546, 3448737, 3393191, 3512547, 2890451, 263203],
    "지역": ["수도권", "수도권", "수도권", "경상권", "경상권", "경상권", "수도권", "수도권"]
}
columns = ["도시", "연도", "인구", "지역"]
df1 = pd.DataFrame(data, columns=columns)
display(df1)


```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>도시</th>
      <th>연도</th>
      <th>인구</th>
      <th>지역</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>서울</td>
      <td>2015</td>
      <td>9904312</td>
      <td>수도권</td>
    </tr>
    <tr>
      <th>1</th>
      <td>서울</td>
      <td>2010</td>
      <td>9631482</td>
      <td>수도권</td>
    </tr>
    <tr>
      <th>2</th>
      <td>서울</td>
      <td>2005</td>
      <td>9762546</td>
      <td>수도권</td>
    </tr>
    <tr>
      <th>3</th>
      <td>부산</td>
      <td>2015</td>
      <td>3448737</td>
      <td>경상권</td>
    </tr>
    <tr>
      <th>4</th>
      <td>부산</td>
      <td>2010</td>
      <td>3393191</td>
      <td>경상권</td>
    </tr>
    <tr>
      <th>5</th>
      <td>부산</td>
      <td>2005</td>
      <td>3512547</td>
      <td>경상권</td>
    </tr>
    <tr>
      <th>6</th>
      <td>인천</td>
      <td>2015</td>
      <td>2890451</td>
      <td>수도권</td>
    </tr>
    <tr>
      <th>7</th>
      <td>인천</td>
      <td>2010</td>
      <td>263203</td>
      <td>수도권</td>
    </tr>
  </tbody>
</table>
</div>


### pivot
내가 원하는 값만 확인하고 싶을 때 쓰는 함수

### 사용법
데이터프레임.pivot(index에 넣고싶은 카테고리, column에 넣고싶은 카테고리, 값을 넣고 싶은 카테고리)



```python
df1.pivot('도시','연도','인구')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>연도</th>
      <th>2005</th>
      <th>2010</th>
      <th>2015</th>
    </tr>
    <tr>
      <th>도시</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>부산</th>
      <td>3512547.0</td>
      <td>3393191.0</td>
      <td>3448737.0</td>
    </tr>
    <tr>
      <th>서울</th>
      <td>9762546.0</td>
      <td>9631482.0</td>
      <td>9904312.0</td>
    </tr>
    <tr>
      <th>인천</th>
      <td>NaN</td>
      <td>263203.0</td>
      <td>2890451.0</td>
    </tr>
  </tbody>
</table>
</div>



도시를 index로 갖고, 연도를 column으로 갖고, 인구를 안의 값으로 가지는 df1의 서브데이터프레임을 출력한 것이다.

### 그룹분석

## group_by

특정 칼럼 혹은 열을 기준으로 데이터 프레임을 재구성 할때 쓰는 함수이다.

### group by 사용법
옵션이 너무 많아서 document에서 갖고 온걸로 대체한다.  

DataFrame.groupby(by=None, axis=0, level=None, as_index=True, sort=True, group_keys=True, squeeze=False, observed=False, **kwargs)




```python
df2 = pd.DataFrame({
    'key1':['A','A', 'B','B','A'],
    'key2':['one', 'two','one', 'two', 'one'],
    'data1':[1,2,3,4,5],
    'data2':[10,20,30,40,50],
})
df2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>data2</th>
      <th>key1</th>
      <th>key2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>10</td>
      <td>A</td>
      <td>one</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>20</td>
      <td>A</td>
      <td>two</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>30</td>
      <td>B</td>
      <td>one</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>40</td>
      <td>B</td>
      <td>two</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>50</td>
      <td>A</td>
      <td>one</td>
    </tr>
  </tbody>
</table>
</div>




```python
g = df2.groupby(df2.data1)
g.sum()

```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data2</th>
    </tr>
    <tr>
      <th>data1</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
    </tr>
    <tr>
      <th>4</th>
      <td>40</td>
    </tr>
    <tr>
      <th>5</th>
      <td>50</td>
    </tr>
  </tbody>
</table>
</div>




```python
df2.groupby(df2.key1).apply(sum)

```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>data2</th>
      <th>key1</th>
      <th>key2</th>
    </tr>
    <tr>
      <th>key1</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>8</td>
      <td>80</td>
      <td>AAA</td>
      <td>onetwoone</td>
    </tr>
    <tr>
      <th>B</th>
      <td>7</td>
      <td>70</td>
      <td>BB</td>
      <td>onetwo</td>
    </tr>
  </tbody>
</table>
</div>




```python
import seaborn as sns

iris = sns.load_dataset('iris')
iris.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
  </tbody>
</table>
</div>



groupby 자체는 실제 데이터를 가져와 주지 않는다.  
카테고리별로 나눈 후에 어떤 값들을 가져올지는 그 뒤에 나오는 매서드로 결정된다.  
그런데 만약 우리가 정의한 함수를 적용시켜서 데이터프레임을 가져오고 싶으면 어떻게 할까?  
그것은 바로 agg이다.
물론 우리가 위에서 배운 apply를 사용해도 문제 없다.  
예시를 한 번 보자


```python
## 내가 쓰고 싶은 함수를 지정하자
def peak_to_peak_ratio(x):
    return x.max()/x.min()

## iris데이터를 품종별로 나눈 후 내가 쓴 함수를 먹이고 싶다.
iris.groupby(iris.species)
a_agg = iris.groupby(iris.species).apply(peak_to_peak_ratio)
display(a_agg)
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>1.348837</td>
      <td>1.913043</td>
      <td>1.900000</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>1.428571</td>
      <td>1.700000</td>
      <td>1.700000</td>
      <td>1.800000</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>1.612245</td>
      <td>1.727273</td>
      <td>1.533333</td>
      <td>1.785714</td>
    </tr>
  </tbody>
</table>
</div>


apply와 agg는 함수를 적용시켜도 본래의 데이터프레임이 번경되지는 않는다.  
만약 데이터프레임에 함수를 적용시키고 적용시킨 것을 그대로 저장하기 위해서는 transform을 사용한다.

iris 데이터에 petal_length_class 칼럼을 만들고 거기에 petal_length를 소, 중, 대로 카테고리화 시킨 값을 집어 넣어보자


```python
def q3cut(s):
    return pd.qcut(s,3,labels = ['소','중','대'])

iris['petal_length_class'] = iris.groupby(iris.species)['petal_length'].transform(q3cut)
iris
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
      <th>petal_length_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>중</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5.4</td>
      <td>3.9</td>
      <td>1.7</td>
      <td>0.4</td>
      <td>setosa</td>
      <td>대</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4.6</td>
      <td>3.4</td>
      <td>1.4</td>
      <td>0.3</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>7</th>
      <td>5.0</td>
      <td>3.4</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>중</td>
    </tr>
    <tr>
      <th>8</th>
      <td>4.4</td>
      <td>2.9</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>9</th>
      <td>4.9</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.1</td>
      <td>setosa</td>
      <td>중</td>
    </tr>
    <tr>
      <th>10</th>
      <td>5.4</td>
      <td>3.7</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>중</td>
    </tr>
    <tr>
      <th>11</th>
      <td>4.8</td>
      <td>3.4</td>
      <td>1.6</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>대</td>
    </tr>
    <tr>
      <th>12</th>
      <td>4.8</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.1</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>13</th>
      <td>4.3</td>
      <td>3.0</td>
      <td>1.1</td>
      <td>0.1</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>14</th>
      <td>5.8</td>
      <td>4.0</td>
      <td>1.2</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>15</th>
      <td>5.7</td>
      <td>4.4</td>
      <td>1.5</td>
      <td>0.4</td>
      <td>setosa</td>
      <td>중</td>
    </tr>
    <tr>
      <th>16</th>
      <td>5.4</td>
      <td>3.9</td>
      <td>1.3</td>
      <td>0.4</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>17</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.3</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>18</th>
      <td>5.7</td>
      <td>3.8</td>
      <td>1.7</td>
      <td>0.3</td>
      <td>setosa</td>
      <td>대</td>
    </tr>
    <tr>
      <th>19</th>
      <td>5.1</td>
      <td>3.8</td>
      <td>1.5</td>
      <td>0.3</td>
      <td>setosa</td>
      <td>중</td>
    </tr>
    <tr>
      <th>20</th>
      <td>5.4</td>
      <td>3.4</td>
      <td>1.7</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>대</td>
    </tr>
    <tr>
      <th>21</th>
      <td>5.1</td>
      <td>3.7</td>
      <td>1.5</td>
      <td>0.4</td>
      <td>setosa</td>
      <td>중</td>
    </tr>
    <tr>
      <th>22</th>
      <td>4.6</td>
      <td>3.6</td>
      <td>1.0</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>23</th>
      <td>5.1</td>
      <td>3.3</td>
      <td>1.7</td>
      <td>0.5</td>
      <td>setosa</td>
      <td>대</td>
    </tr>
    <tr>
      <th>24</th>
      <td>4.8</td>
      <td>3.4</td>
      <td>1.9</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>대</td>
    </tr>
    <tr>
      <th>25</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.6</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>대</td>
    </tr>
    <tr>
      <th>26</th>
      <td>5.0</td>
      <td>3.4</td>
      <td>1.6</td>
      <td>0.4</td>
      <td>setosa</td>
      <td>대</td>
    </tr>
    <tr>
      <th>27</th>
      <td>5.2</td>
      <td>3.5</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>중</td>
    </tr>
    <tr>
      <th>28</th>
      <td>5.2</td>
      <td>3.4</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>29</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.6</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>대</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>120</th>
      <td>6.9</td>
      <td>3.2</td>
      <td>5.7</td>
      <td>2.3</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>121</th>
      <td>5.6</td>
      <td>2.8</td>
      <td>4.9</td>
      <td>2.0</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>122</th>
      <td>7.7</td>
      <td>2.8</td>
      <td>6.7</td>
      <td>2.0</td>
      <td>virginica</td>
      <td>대</td>
    </tr>
    <tr>
      <th>123</th>
      <td>6.3</td>
      <td>2.7</td>
      <td>4.9</td>
      <td>1.8</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>124</th>
      <td>6.7</td>
      <td>3.3</td>
      <td>5.7</td>
      <td>2.1</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>125</th>
      <td>7.2</td>
      <td>3.2</td>
      <td>6.0</td>
      <td>1.8</td>
      <td>virginica</td>
      <td>대</td>
    </tr>
    <tr>
      <th>126</th>
      <td>6.2</td>
      <td>2.8</td>
      <td>4.8</td>
      <td>1.8</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>127</th>
      <td>6.1</td>
      <td>3.0</td>
      <td>4.9</td>
      <td>1.8</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>128</th>
      <td>6.4</td>
      <td>2.8</td>
      <td>5.6</td>
      <td>2.1</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>129</th>
      <td>7.2</td>
      <td>3.0</td>
      <td>5.8</td>
      <td>1.6</td>
      <td>virginica</td>
      <td>대</td>
    </tr>
    <tr>
      <th>130</th>
      <td>7.4</td>
      <td>2.8</td>
      <td>6.1</td>
      <td>1.9</td>
      <td>virginica</td>
      <td>대</td>
    </tr>
    <tr>
      <th>131</th>
      <td>7.9</td>
      <td>3.8</td>
      <td>6.4</td>
      <td>2.0</td>
      <td>virginica</td>
      <td>대</td>
    </tr>
    <tr>
      <th>132</th>
      <td>6.4</td>
      <td>2.8</td>
      <td>5.6</td>
      <td>2.2</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>133</th>
      <td>6.3</td>
      <td>2.8</td>
      <td>5.1</td>
      <td>1.5</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>134</th>
      <td>6.1</td>
      <td>2.6</td>
      <td>5.6</td>
      <td>1.4</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>135</th>
      <td>7.7</td>
      <td>3.0</td>
      <td>6.1</td>
      <td>2.3</td>
      <td>virginica</td>
      <td>대</td>
    </tr>
    <tr>
      <th>136</th>
      <td>6.3</td>
      <td>3.4</td>
      <td>5.6</td>
      <td>2.4</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>137</th>
      <td>6.4</td>
      <td>3.1</td>
      <td>5.5</td>
      <td>1.8</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>138</th>
      <td>6.0</td>
      <td>3.0</td>
      <td>4.8</td>
      <td>1.8</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>139</th>
      <td>6.9</td>
      <td>3.1</td>
      <td>5.4</td>
      <td>2.1</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>140</th>
      <td>6.7</td>
      <td>3.1</td>
      <td>5.6</td>
      <td>2.4</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>141</th>
      <td>6.9</td>
      <td>3.1</td>
      <td>5.1</td>
      <td>2.3</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>142</th>
      <td>5.8</td>
      <td>2.7</td>
      <td>5.1</td>
      <td>1.9</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>143</th>
      <td>6.8</td>
      <td>3.2</td>
      <td>5.9</td>
      <td>2.3</td>
      <td>virginica</td>
      <td>대</td>
    </tr>
    <tr>
      <th>144</th>
      <td>6.7</td>
      <td>3.3</td>
      <td>5.7</td>
      <td>2.5</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>145</th>
      <td>6.7</td>
      <td>3.0</td>
      <td>5.2</td>
      <td>2.3</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>146</th>
      <td>6.3</td>
      <td>2.5</td>
      <td>5.0</td>
      <td>1.9</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>147</th>
      <td>6.5</td>
      <td>3.0</td>
      <td>5.2</td>
      <td>2.0</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>148</th>
      <td>6.2</td>
      <td>3.4</td>
      <td>5.4</td>
      <td>2.3</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>149</th>
      <td>5.9</td>
      <td>3.0</td>
      <td>5.1</td>
      <td>1.8</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
  </tbody>
</table>
<p>150 rows × 6 columns</p>
</div>



## 연습문제

iris붓꽃 데이터를 품종별로 꽃잎 길이, 꽃입 너비, 꽃받침 길이, 꽃받침 너비의 평균을 구하여라  
여러분들을 위해서 남겨 놓겠습니다.

## 알게된 점

- 데이터프레임.sum()은 행별로 다 더한 값을 시리즈로 나타내준다.




```python

```
